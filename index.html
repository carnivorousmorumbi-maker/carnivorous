<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Carnivorous</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body { margin:0; font-family:Arial; background:#000; color:#fff; }
header { display:flex; align-items:center; gap:15px; padding:15px; background:#111; }
header img { height:60px; }
header h1 { font-size:42px; margin:0; flex:1; }
header input, header select { padding:8px; border-radius:6px; border:none; }

#produtos { padding:20px; }
.categoria { margin-top:30px; }
.categoria h2 { border-bottom:2px solid #333; }

.produto { border-bottom:1px solid #222; padding:10px 0; }
.controle button { padding:4px 10px; }

#botaoCarrinho {
  position:fixed; bottom:20px; right:20px;
  background:#25d366; color:#000;
  padding:15px; border-radius:50%; cursor:pointer;
}

#carrinho {
  display:none; position:fixed; inset:0;
  background:#000; padding:20px;
}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <h1>Carnivorous</h1>
  <input id="busca" placeholder="Buscar..." onkeyup="filtrarProdutos()">
  <select id="filtroCategoria" onchange="filtrarProdutos()">
    <option value="">Categorias</option>
  </select>
</header>

<div id="produtos"></div>

<div id="botaoCarrinho" onclick="abrirCarrinho()">
ðŸ›’ <span id="qtdCarrinho">0</span><br>
<span id="totalCarrinho">R$ 0,00</span>
</div>

<div id="carrinho">
<h2>Carrinho</h2>
<div id="listaCarrinho"></div>
<h3 id="totalFinal"></h3>
<button onclick="finalizarPedido()">Finalizar WhatsApp</button>
<button onclick="fecharCarrinho()">Fechar</button>
</div>

<script>
const PLANILHA =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTsqDIhOoTibb56-QuExYbR9PfD1Fbu4y5x1a9k3X5BcLdl3rRA7tGmCQNI_Gn-uAlkYdUr1FtMigyA/pub?output=csv";

let produtos = [];
const carrinho = {};

const produtosDiv = document.getElementById("produtos");

Papa.parse(PLANILHA, {
  download:true,
  header:true,
  skipEmptyLines:true,
  complete: res => {
    produtos = res.data.map(l => ({
      nome: l["Produto"] || l["Nome"],
      categoria: l["Categoria"],
      preco: Number(
        String(l["Valor"] || l["PreÃ§o"])
        .replace("R$","").replace(".","").replace(",",".")
      )
    })).filter(p => p.nome && p.preco);

    carregarCategorias();
    renderizarProdutos();
  }
});

function carregarCategorias(){
  const cats = [...new Set(produtos.map(p=>p.categoria))];
  cats.forEach(c=>{
    filtroCategoria.innerHTML += `<option value="${c}">${c}</option>`;
  });
}

function renderizarProdutos(lista=produtos){
  produtosDiv.innerHTML="";
  const porCat={};
  lista.forEach(p=>{
    porCat[p.categoria]=porCat[p.categoria]||[];
    porCat[p.categoria].push(p);
  });

  for(const c in porCat){
    produtosDiv.innerHTML+=`<div class="categoria"><h2>${c}</h2></div>`;
    porCat[c].forEach(p=>{
      const id=p.nome.replace(/\W/g,"");
      produtosDiv.innerHTML+=`
      <div class="produto">
        <b>${p.nome}</b><br>
        R$ ${p.preco.toFixed(2)}<br>
        <button onclick="remover('${p.nome}')">âˆ’</button>
        <span id="qtd-${id}">0</span>
        <button onclick="adicionar('${p.nome}',${p.preco})">+</button>
      </div>`;
    });
  }
}

function adicionar(nome,preco){
  carrinho[nome]=carrinho[nome]||{qtd:0,preco};
  carrinho[nome].qtd++;
  atualizar();
}

function remover(nome){
  if(!carrinho[nome])return;
  carrinho[nome].qtd--;
  if(carrinho[nome].qtd<=0) delete carrinho[nome];
  atualizar();
}

function atualizar(){
  let q=0,t=0;
  document.querySelectorAll('[id^="qtd-"]').forEach(e=>e.innerText=0);
  for(const i in carrinho){
    q+=carrinho[i].qtd;
    t+=carrinho[i].qtd*carrinho[i].preco;
    const s=document.getElementById("qtd-"+i.replace(/\W/g,""));
    if(s) s.innerText=carrinho[i].qtd;
  }
  qtdCarrinho.innerText=q;
  totalCarrinho.innerText="R$ "+t.toFixed(2);
}

function abrirCarrinho(){
  carrinhoDiv.style.display="block";
  listaCarrinho.innerHTML="";
  let t=0;
  for(const i in carrinho){
    const sub=carrinho[i].qtd*carrinho[i].preco;
    t+=sub;
    listaCarrinho.innerHTML+=`${i} x${carrinho[i].qtd} = R$ ${sub.toFixed(2)}<br>`;
  }
  totalFinal.innerText="TOTAL: R$ "+t.toFixed(2);
}

function fecharCarrinho(){ carrinhoDiv.style.display="none"; }

function finalizarPedido(){
  window.open("https://wa.me/5511999562721");
}

function filtrarProdutos(){
  const t=busca.value.toLowerCase();
  const c=filtroCategoria.value;
  renderizarProdutos(produtos.filter(p =>
    p.nome.toLowerCase().includes(t) &&
    (!c || p.categoria===c)
  ));
}
</script>

</body>
</html>
